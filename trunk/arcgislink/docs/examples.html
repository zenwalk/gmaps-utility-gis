<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>ArcGIS Server Link for Google Maps API: Examples</title><!-- nofollow -->
    <link rel="stylesheet" type="text/css" href="http://code.google.com/css/codesite.css"/>
    <link rel="stylesheet" type="text/css" href="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/util/docs/template/local_extensions.css"/>
    <script type="text/javascript" src="http://code.google.com/js/prettify.js"></script>
  </head>
  <body onload="prettyPrint()">
<div>
<a name="Top"></a>  
<h1><a></a>ArcGIS Server Link for Google Maps API V3: Examples</h1>
<p><b>
 <a href="reference.html">Class References</a>
  </b></p>
</div>
<div>
<h2><a name="TOC"></a>Table of Contents</h2>
    <p>This library allows the developers to use ESRI ArcGIS server v10 in Google Maps 
        JavaScript API v3. The library was ported from an
        <a href="http://http://gmaps-utility-library-dev.googlecode.com/svn/trunk/arcgislink/docs/examples.html">
        earlier version</a> that developed against ArcGIS Server 9.3 and Google API v2.
    </p>
    <p>There are substaintial changes from Google API from v2 to v3, not all features in 
        v2 are ported to v3, including some related to projection support. Although this 
        library still supports non-mercator projection, it is recommended that map 
        caches built using Google/Bing scheme to get the more stable and reliable 
        behavior. </p>
<table style='border:0px'>
  <tr>
    <td style='border:0px'>
       
      <ul>
<li><a href="#Mercator">Cached Map (Web Mercator</a>)</li>
<li><a href="#Dyna">Dynamic Map Service</a></li>
<li><a href="#Combined">Combining Cached and Dynamic Maps</a></li>
<li><a href="#MapTypeOverlay">Cached Map as Overlay</a></li>
<li><a href="#StatePlane">State Plane Coordinate System</a></li>
<li><a href="#ArcGISOnline">ArcGISOnline Maps</a></li>
<li><a href="#Opacity">Map Opacity</a></li>
<li><a href="#Hosts">Rotating Hosts for Tiles</a></li>
</ul>
    </td>
    <td style="border:0px">
   <ul>
   <li><a href="#MapClick">Identify Map</a></li>
   <li><a href="#LayerDef">Layer Definition</a></li>
   <li><a href="#LayerVis">Layer Visibility (TOC)</a></li>
   <li><a href="#HourGlass">Show &quot;Hourglass&quot; using events</a></li>
   <li><a href="#LayerQuery">Layer Query / Mouseover</a></li>
   <li><a href="#Find">Find</a></li>
   <li><a href="#Geocode">Geocode</a></li>
   <li><a href="#ReverseGeocode">ReverseGeocode</a></li>
   <li><a href="#Generic">Generic ArcGIS Viewer</a></li>
   </ul>
   </td>
  </tr>
</table>
</div>
<div>
<h2><a name="HowTo"></a>Include Scripts</h2>
<p>
The first step is to include <code>arcgislink.js</code>  
    or <code>arcgislink_compressed.js</code> 
in your document header, after the Google Maps API has loaded. You can use the 
hosted release version if you do not want to download the script.</p>
<pre class="prettyprint">
&lt;script src=&quot;/path/to/argislink_compressed.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
</pre>
</div>
<div>
<h2><a name="Mercator"></a>Cached Map Service in Web Mercator</h2>
<p> 
    Cached map service may provide better response time because it's pre-rendered as tiles. If the 
    map service is tiled using the same tiling scheme as Google Maps (WebMercator in 
    ArcGIS), it can be added as a map type directly. The following example 
    constructs a new with only an ArcGIS map type and no Google map types.
</p>
<pre class="prettyprint">
    var url = 'http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Portland/ESRI_LandBase_WebMercator/MapServer';
    var agsType = new  gmaps.ags.MapType(url,{name:'ArcGIS'});
    map.mapTypes.set('arcgis', agsType);
    map.setMapTypeId('arcgis');
 </pre>
<p>
<a href="../examples/mercator.html">View example </a> |
<a href="../examples/mercator.html?compressed">Compressed </a> |
<a href="../examples/nexus.html?u=mercator.html">Phone Size </a> |
<a href="#Top">Back to top</a>
</p>
</div>

<div>
<h2><a name="Dyna"></a>Dynamic Map Service</h2>
<p> ArcGIS Server provides map services to generate map images on the fly, 
also known as "dynamic map". Dynamic services are implemented as 
    <a href='reference.html#MapOverlay'>MapOverlay</a>,
 a subclass of <code>google.maps.OverlayView</code>, and can be
  added with <code>overlay.setMap(map)</code>. This class is similar 
to the <code>google.maps.GoundOverlay</code> in the core API, as it essentially draws a 
single image over the map. However, it refreshes the image as bounds changed. Any map service can be added as an MapOverlay, 
regardless of whether it's tiled or not.


<pre class="prettyprint">
    var url = &#39;http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Census_USA/MapServer&#39;;
    var dynamap = new gmaps.ags.MapOverlay(url);
    dynamap.setMap(map);
</pre>

<p>
<a href="../examples/dynamap.html">View example </a> |
<a href="../examples/dynamap.html?compressed">Compressed </a> |
<a href="../examples/nexus.html?u=dynamap.html">Phone Size </a> |
<a href="#Top">Back to top</a>
</p>
</div>
<div>
<h2><a name="Combined"></a>Combining Tiled and Dynamic Layer</h2>
<p>In many situations, it&#39;s ideal to combined a tiled map as a background, with a 
    dynamic map service that serves operational layers on top of it. </p>
<pre class="prettyprint">
    var wmUrl = baseUrl + '/Portland/ESRI_LandBase_WebMercator/MapServer';
    var dynaUrl = baseUrl + '/Demographics/ESRI_Census_USA/MapServer';
    var agsType = new gmaps.ags.MapType(wmUrl,{name:'ArcGIS'});
    map.mapTypes.set('arcgis', agsType);
    var dynamap = new gmaps.ags.MapOverlay(dynaUrl);
    dynamap.setMap(map);   
</pre>
<p>
<a href="../examples/combined.html">View example </a> |
<a href="../examples/combined.html?compressed">Compressed </a> | 
<a href="../examples/nexus.html?u=combined.html">Phone Size </a> |
<a href="#Top">Back to top</a>
</p>
</div>

<div>
<h2><a name="MapTypeOverlay"></a>Cached Map as Overlay</h2>
<p> Cached Map Service can also be added as Overlay, 
    and displays on top of all base map types. It&#39;s similar to V2&#39;s <code>GTileLayerOverlay</code>.
<pre class="prettyprint">
    var url = 'http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Portland/ESRI_LandBase_WebMercator/MapServer';
    var agsType = new  gmaps.ags.MapType(url,{name:'ArcGIS', opacity:0.5});
    map.overlayMapTypes.insertAt(0, agsType);
</pre>

<p>
<a href="../examples/maptypeoverlay.html">View example</a> |
<a href="../examples/maptypeoverlay.html?compressed">Compressed</a> |
<a href="../examples/nexus.html?u=maptypeoverlay.html">Phone Size </a> |
<a href="#Top">Back to top</a>
</p>
</div>
<div>
<h2><a name="StatePlane"></a>State Plane Coordinate System</h2>
<p> Virtually all GIS data collected by State or Local Governments in 
Unite States are stored in one of the 
<a target="_blank" href="http://en.wikipedia.org/wiki/State_Plane_Coordinate_System">
State Plane Coordinate Systems</a>. In real-world operations, many map services 
(both tiled and dynamic) are published using the native
coordinate system the data uses. </p>
<p>When adding an <a href="reference.html#TileLayer">TileLayer</a> 
from a tiled map service, the spatial reference of the map service must be loaded
 into the internal 
<a href="reference.html#SpatialReferences">SpatialReferences</a> collections
before it can be used. The library has 4 built-in spatial references: 
NAD GCS (4269), WGS84 (4326), "Web Mercator" (102113 & 102000). 
It also supports any spatial references based on 
<a target=wiki href='http://en.wikipedia.org/wiki/Lambert_conformal_conic_projection'>
Lambert Conformal Conic Projection</a>
or <a target=wiki href='http://en.wikipedia.org/wiki/Transverse_Mercator_projection'>
Transverse Mercator Projection</a>. They can be added either with one line of 
code by its Well_known_text format or constructed directly with correct 
parameters. Please use the WKT value from 
<a target=esri href='http://edndoc.esri.com/arcims/9.2/elements/pcs.htm'>
ESRI documentation</a>. However, if the map services returns WKT, then it&#39;s not 
    necessary to add the wkid. Spatial references based on other projections can be used 
by implementing the 
<a href="reference.html#SpatialReference">SpatialReference</a> 
interface. </p>
    <p>In V3, zoom is removed from <code>google.maps.Projection</code> interface, as a result, <b>the scale ratio between
adjacent zoom levels must be exactly 2</b>. Also, the tile layer must be constructed after the 'load' event of the map service so the application knows the tile size and scales. </p>
<pre class="prettyprint">
    var url = 'http://maps.ci.charlotte.nc.us/ArcGIS/rest/services/GET/BaseMap/MapServer';
    var svc = new gmaps.ags.MapService(url);
    google.maps.event.addListenerOnce(svc, 'load', function() {
            try {
              var tileLayer = new gmaps.ags.TileLayer(svc);
              var agsType = new gmaps.ags.MapType([tileLayer], {
                name: 'StatePlane'
              });
              var bnds = svc.getInitialBounds();
              var myOptions = {
                zoom: 12,
                center: bnds.getCenter(),
                mapTypeId: 'stateplane',
                mapTypeControlOptions: {
                  mapTypeIds: ['stateplane', google.maps.MapTypeId.ROADMAP]
                }
              }
              var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
              map.mapTypes.set('stateplane', agsType);
            } catch (e) {
              alert(e);
            }
          });
          </pre>

<p>
<a href="../examples/stateplane.html">View example </a> |
<a href="../examples/stateplane.html?compressed">Compressed </a> | 
<a href="../examples/nexus.html?u=stateplane.html">Phone Size </a> |
<a href="#Top">Back to top</a>
</p>
</div>

<div>
<h2><a name="ArcGISOnline"></a>ArcGISOnline Services</h2>
<p> <a href="http://www.arcgisonline.com">ArcGISOnline</a> is an 
online geo-spatial service provided by 
<a href="http://www.esri.com">ESRI, Inc</a>. It is a large online repository of mapping resources.
    Since Q1 of 2010, all the tiled map services are based on web mercator, which is 
    compatible with Google / Bing maps.</p>
<p>Check <a href='http://resources.esri.com/arcgisonlineservices/index.cfm?fa=Licensing'>Licensing</a> 
 before you use these services. </p>

<pre class="prettyprint">
    var services = {
     'USA Topo' : ['USA_Topo_Maps']
     ,'Streets' : ['World_Street_Map']
     ,'World Topo': ['World_Topo_Map']
     ,'Imagery':['World_Imagery']
     ,'Labeled Imagery': ['World_Imagery','Reference/World_Boundaries_and_Places']
     ,'Terrain' : ['World_Terrain_Base']
     ,'Labeled Terrain' : ['World_Terrain_Base','Reference/World_Reference_Overlay']
    };
    var agsIds = [];
    var agsTypes = [];
    for (var x in services) {
      if (services.hasOwnProperty(x)) {
        agsIds.push(x);
        var urls = services[x];
        for (var i = 0; i < urls.length; i++) {
          urls[i] = 'http://services.arcgisonline.com/ArcGIS/rest/services/' + urls[i] + '/MapServer';
        }
        agsTypes.push(new gmaps.ags.MapType(urls, {name:x}));
      }
    }
    ....
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    for (var i = 0; i < agsIds.length; i++) {
      map.mapTypes.set(agsIds[i], agsTypes[i]);
    }
</pre>

<p>
<a href="../examples/arcgisonline.html">View example </a> |
<a href="../examples/arcgisonline.html?compressed">Compressed </a> | 
<a href="../examples/nexus.html?u=arcgisonline.html">Phone Size </a> | 
<a href="#Top">Back to top</a>
</p>
</div>
<div>
<h2><a name="Opacity"></a>Map Opacity</h2>
<p> In V3 the <code>google.maps.MapType.getTile</code> method offers greater flexibility to manipulate individual tiles, thus provides 
the capability of setting opacity on the fly. Also, the one-many relationship between MapType and TileLayer from V2 is preserved for finer control of tile sets. For example, 
Hybrid map type contains an image tile set and a label tile set. Opacity can be controled at tile layer level in addition to Map type level.
The following example uses a 
    <a href="http://google-maps-utility-library-v3.googlecode.com/svn/tags/extdraggableobject/1.0/">slider</a> 
    from the V3 util lib to change the opacity of the top map type overlay. It's possible to built animation using historic image tiles with this feature. 
 </p>

<pre class="prettyprint">
    var opacity = 0.5;
    var url = 'http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Portland/ESRI_LandBase_WebMercator/MapServer';
    var agsType = new gmaps.ags.MapType(url, {
      name: 'ArcGIS',
      opacity: opacity
    });
    map.overlayMapTypes.insertAt(0, agsType);
    
    ....
    google.maps.event.addListener(opSlider, 'drag', function(evt){
       var op = opSlider.left()/range;
       agsType.setOpacity(op);
    });
</pre>

<p>
<a href="../examples/opacity.html">View example </a> |
<a href="../examples/opacity.html?compressed">Compressed </a> | 
<a href="../examples/nexus.html?u=opacity.html">Phone Size </a> | 
<a href="#Top">Back to top</a>
</p>
</div>

<div>
<h2><a name="Hosts"></a>Rotating Hosts for Tiles</h2>
<p> Some browsers has default limitations on how many concurrent connections can 
be made to a give host based on URL name, so that when many tiles are being 
downloaded, some of them have to wait in the queue. One workaround for this 
issue is to create multiple DNS names with numbers as suffix. 
There is an option in the <code>gmaps.ags.TileLayer</code> constructor to allow you 
to specify an 'host pattern', for example, "mt[4].google.com" means 
to rotate hosts across mt0.google.com, mt1.google.com, mt2.google.com, 
mt3.google.com (4 hosts) </p>
<pre class="prettyprint">
   var url = 'http://maps.ci.charlotte.nc.us/ArcGIS/rest/services/GET/BaseMapWM/MapServer';
   var tileLayer = new gmaps.ags.TileLayer(url, {
      hosts:'mt[4].ci.charlotte.nc.us' 
   })
   var agsType = new  gmaps.ags.MapType([tileLayer],{name:'ArcGIS'});
   map.mapTypes.set('arcgis', agsType);
   map.setMapTypeId('arcgis');
</pre>

<p>
<a href="../examples/hosts.html">View example </a> |
<a href="../examples/hosts.html?compressed">Compressed </a> | 
<a href="#Top">Back to top</a>
</p>
</div>

<div>
<h2><a name="LayerDef"></a>Layer Definition</h2>
<p>You can draw a subset of a feature layer inside a dynamic map service 
(<a href="reference.html#ArcGISMapOverlay">ArcGISMapOverlay</a>) by setting a 
SQL expression as  its <code>definition</code> property. 
You will have to use the <a href="reference.html#ArcGISLayer">ArcGISLayer</a> 
class in the REST part of the libarary.</p>
<pre class="prettyprint">
var service = dynaLayer.getMapService();
service.getLayer("Coarse Counties").definition="STATE_NAME='Kansas' and POP2007 &gt; 25000";
service.getLayer("Detailed Counties").definition="STATE_NAME='Kansas' and POP2007 &gt; 25000";
service.getLayer("states").definition="STATE_NAME='Kansas'";
</pre>

<p>
<a href="../examples/layerdef.html">View example </a> |
<a href="../examples/layerdef.html?compressed">Compressed </a> | 
<a href="#Top">Back to top</a>
</p>
</div>
<div>
<h2><a name="LayerVis"></a>Layer Visibility (TOC)</h2>
<p> You can control visibility of a layer inside a dynamic map service
 (<a href="reference.html#ArcGISMapOverlay">ArcGISMapOverlay</a>)
 by setting its <code>visible</code> property. There are some limitations on 
the scale threshold on layers in the REST API. 
You will have to load the layer resource individually if you
want to do a TOC that handles scales. 
 <pre class="prettyprint">
var service = dynaLayer.getMapService();
service.getLayer("states").visible = true;
dynaLayer.refresh();
</pre>

<p>
<a href="../examples/layervis.html">View example </a> |
<a href="../examples/layervis.html?compressed">Compressed </a> | 
<a href="#Top">Back to top</a>
</p>
</div>

<div>
<h2><a name="HourGlass"></a>Show/Hide HourGlass with events</h2>
<p>A dynamic map image may take some time to render. 
When a intensive server request like map rendering is running in the 
background, it's helpful to let the user know about it. 
You can display some sort of hourglass animation image or simply a
message such as "loading...". 
You can accomplish this by handling different "<code>***start</code>" 
and "<code>***end</code>" events, or use <code>ArcGISUtil#jsonpstart</code> 
and <code>ArcGISUtil#jsonpend</code> event to monitor all server requests
</p> 
<pre class="prettyprint">
GEvent.addListener(dynaLayer, 'drawstart', function(){
  document.getElementById('drawing').style.visibility = 'visible';
});
GEvent.addListener(dynaLayer, 'drawend', function(){
  document.getElementById('drawing').style.visibility = 'hidden';
});
GEvent.addListener(ArcGISUtil, 'jsonpstart', function(){
  document.getElementById('working').innerHTML = "working....";
});
GEvent.addListener(ArcGISUtil, 'jsonpend', function(){
  document.getElementById('working').innerHTML = '';
});
</pre>

<p>
<a href="../examples/hourglass.html">View example </a> |
<a href="../examples/hourglass.html?compressed">Compressed </a> | 
<a href="#Top">Back to top</a>
</p>
</div>
<div>
<h2><a name="LayerQuery"></a>Layer Query</h2>
<p>You can query a layer with a SQL statement and spatial filters. 
The result can be displayed as overlays, like markers or polys.
You can also attach mouse events to those overlays to 
make the application more interactive.
</p> 
<pre class="prettyprint">
function initFunctionality(){
  var layer = dyna.getMapService().getLayer(3);
  var params = {
    returnGeometry: true,
    where: "STATE_NAME = 'South Carolina'",
    outFields: ["NAME", "POP2000", "POP2007", "POP00_SQMI", "POP07_SQMI"],
    outSR: 4326
  };
  layer.query(params, processResultSet);
}

function processResultSet(rs){
  var fs = rs.features;
  for (var i = 0, c = fs.length; i &lt; c; i++) {
    var ovs = createGPolys(fs[i], rs.spatialReference);
    for (var j = 0; j &lt; ovs.length; j++) {
      gmap.addOverlay(ovs[j]);
    }
  }
}

function createGPolys(feat, sr){
  var ovs = ArcGISUtil.fromFeatureToOverlays(feat,sr, style);
  var ov = ovs[j];
  GEvent.addListener(ov, 'mouseover', function(){
    for (var i = 0, ic = ovs.length; i &lt; ic; i++) {
      ovs[i].setStrokeStyle({color: hStyle.outlineColor,weight: hStyle.outlineWeight});
      ovs[i].setFillStyle({ color: hStyle.fillColor,opacity: hStyle.fillOpacity});
    }
    var latlng = ov.getBounds().getCenter();
    gmap.openInfoWindowHtml(latlng, html);
  }); 
  return ovs;
}
</pre>

<p>
<a href="../examples/layerquery.html">View example </a> |
<a href="../examples/layerquery.html?compressed">Compressed </a> | 
<a href="#Top">Back to top</a>
</p>
</div>
<div>
<h2><a name="Find"></a>Find</h2>
<p>Find is an operation supported by a map service to query features based on a 
single String. It will search the attribute columns
of the map layers inside the map service and return matching features.</p>
<pre class="prettyprint">
var params = {
  returnGeometry: true,
  searchText: q,
  contains:!exact,
  layers:['Cities','Rivers','States'],
  searchFields:["CITY_NAME","NAME","SYSTEM","STATE_ABBR","STATE_NAME"],
  sr: 4326
};
service.find(params, processFindResults);
      
function processFindResults(rs) {
  var fs = rs.results;
  for (var i = 0, c = fs.length; i &lt; c; i++) {
    processFindResult(fs[i]);
  }
}
    
function processFindResult(res) {
  var ovs = ArcGISUtil.fromFeatureToOverlays(res);
  gmap.addOverlays(ovs);
}
</pre>

<p>
<a href="../examples/find.html">View example </a> |
<a href="../examples/find.html?compressed">Compressed </a> | 
<a href="#Top">Back to top</a>
</p>
</div>
<div>
<h2><a name="Geocode"></a>Geocode</h2>
<p>You can get the coordinates of a location by passing itss address 
or other descriptions. You can use 
<a href="reference.html#ArcGISGeocodeService">ArcGISGeocodeService</a>'s 
<code>findAddressCandidates</code> method. You can dynamically construct 
an input form based on the meta data of the GeocodeService such as 
'addressFields' property.</p> 
 
<pre class="prettyprint">
var inputs = { };
var fields=geocoder.addressFields;
for (var i=0; i &lt; fields.length; i++){
  inputs[fields[i].name]=document.getElementById(fields[i].name).value;
}
geocoder.findAddressCandidates({inputs: inputs}, function(results) {
  var markers = [];
  if (results.candidates) {
    for (var i = 0, c = results.candidates.length; i &lt; c; i++) {
      var marker=createMarker(results.candidates[i]);
      map.addOverlay(marker);
      markers.push(marker);
      if (i == 0) {
        map.setCenter(marker.getLatLng(),15);
        GEvent.trigger(marker, 'click');
      }
    }
  }
});
</pre>

<p>
<a href="../examples/geocode.html">View example </a> |
<a href="../examples/geocode.html?compressed">Compressed </a> | 
<a href="#Top">Back to top</a>
</p>
</div>
<div>
  <div>
<h2><a name="ReverseGeocode"></a>Reverse Geocode</h2>
<p>You can also find the address of a given geographic coordinates 
(reverse geocode), using 
<a href="reference.html#GeocodeService">GeocodeService</a>'s 
<code>reverseGeocode</code> method.</p> 
<pre class="prettyprint">
function reverseGeocode(latlng){
  if (latlng){
    var point = ArcGISUtil.fromLatLngToPoint(latlng);
    var params = {
      location: point,
      distance: 100
    };
    geocoder.reverseGeocode(params, function(result) {
      if (result.address) {
        var html = '';
        var attrs = result.address;
        for (var x in attrs) {
    if (attrs.hasOwnProperty(x)) {
      html += x +': '+ attrs[x] + '&lt;br/&gt;';
    }
        }
        var loc=ArcGISUtil.fromPointToLatLng(result.location);
        marker.setLatLng(loc);
        marker.openInfoWindowHtml(html);
      } else { 
        alert('can not find address for point:'+latlng.toString());
      }
    });
  }      
}
</pre>

<p>
<a href="../examples/reverse.html">View example </a> |
<a href="../examples/reverse.html?compressed">Compressed </a> | 
<a href="#Top">Back to top</a>
</p>
</div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3946449-5");
pageTracker._trackPageview();
</script>
</body>
</html>
