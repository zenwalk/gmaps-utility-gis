<!DOCTYPE html "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <title>Google Maps - Max Infowindow API Example</title>
        <script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=ABQIAAAAjU0EJWnWPMv7oQ-jjS7dYxQGj0PqsCtxKvarsoS-iqLdqZSKfxRdmoPmGl7Y9335WLC36wIGYa6o5Q" type="text/javascript">
        </script>
        <script type="text/javascript">
            document.write('<script type="text/javascript" src="../src/maxinfowindow' + (document.location.search.indexOf('packed') > -1 ? '_packed' : '') + '.js"><' + '/script>');
        </script>
        
        <script type="text/javascript">
            var map;
            function initialize() {
              if (GBrowserIsCompatible()) {
                map = new GMap2(document.getElementById("map_canvas"));
                var geocoder = new GClientGeocoder();
                var panoClient = new GStreetviewClient();
                
                var pt = new GLatLng(37.4419, -122.1419);
                map.setCenter(pt, 13);
                map.addControl(new GLargeMapControl());
                var iw = map.getInfoWindow();
                GEvent.addListener(map, 'click', function(ov, latlng, ovll) {
                  if (latlng) {
                    var summary = '<div id="sum"></div>';
                    var tabs = [new GInfoWindowTab('address', '<div id="address"></div>'), new GInfoWindowTab('streetview', '<div id="pano" style="width:100%;height:100%"></div>')];
                    map.openInfoWindowMaxTabsHtml(latlng, latlng.toString(), summary, tabs, {
                      maxTitle: "More Info"
                    });
                    
                    var lis = GEvent.addListener(iw, 'maximizeend', function() {
                      geocoder.getLocations(latlng, function(response) {
                        if (!response || response.Status.code != 200) {
                          alert("Status Code:" + response.Status.code);
                        } else {
                          var place = response.Placemark[0];
                          document.getElementById('sum').innerHTML = place.address;
                          document.getElementById('address').innerHTML = '<b>orig latlng:</b>' + response.name + '<br/>' +
                          '<b>latlng:</b>' +
                          place.Point.coordinates[0] +
                          "," +
                          place.Point.coordinates[1] +
                          '<br>' +
                          '<b>Status Code:</b>' +
                          response.Status.code +
                          '<br>' +
                          '<b>Status Request:</b>' +
                          response.Status.request +
                          '<br>' +
                          '<b>Address:</b>' +
                          place.address +
                          '<br>' +
                          '<b>Accuracy:</b>' +
                          place.AddressDetails.Accuracy +
                          '<br>' +
                          '<b>Country code:</b> ' +
                          place.AddressDetails.Country.CountryNameCode;
                        }
                        
                      });
                      panoClient.getNearestPanorama(latlng, function(panoData) {
                        if (panoData.code != 200) {
                          GLog.write('showPanoData: Server rejected with code: ' + panoData.code);
                          return;
                        }
                        var myPano = new GStreetviewPanorama(document.getElementById("pano"));
                        
                        myPano.setLocationAndPOV(panoData.location.latlng);
                        
                        
                      });
                      
                      
                    });
                  }
                });
              }
            }
        </script>
    </head>
    <body onload="initialize()" onunload="GUnload()">
        <div id="map_canvas" style="width: 100%; height: 400px; font-family: Arial, sans serif">
        </div>
    </body>
</html>
