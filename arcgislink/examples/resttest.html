<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>Simple Testing Example</title>
        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.5.2/build/logger/assets/skins/sam/logger.css" />
        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.5.2/build/fonts/fonts-min.css" />
        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.5.2/build/yuitest/assets/skins/sam/yuitest.css" />
        <script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/yahoo-dom-event/yahoo-dom-event.js">
        </script>
        <script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/logger/logger-min.js">
        </script>
        <script type="text/javascript" src="http://yui.yahooapis.com/2.5.2/build/yuitest/yuitest-min.js">
        </script>
        <script type="text/javascript">
            var gkey = 'ABQIAAAAiOIdlCs11aj2JsFS38tclBQyymMIEK3n3_qPPkS7tuUiM3j-ThSHD4i3Rupc--5mwNt7KZ_aYMUQJQ';//imsdev
            var host = document.location.host;
            if (host.indexOf('pages') > -1) {
              gkey = 'ABQIAAAAGY8Xhrw1zw6Ia3dwUJVxKRT_Dik9yxNP5XbRDcNbZKLa1CrDkxRDjJast2WNsqXjiEGPt_8s229nyw';
            } else if (host.indexOf('org') > -1) {
              gkey = 'ABQIAAAAiOIdlCs11aj2JsFS38tclBQfKfnu-mh0q_bJgSL96pCW-X8IuhTkUHKzIl8dkf8AaWQ2-R0nXzUiSg';
            } else if (host.indexOf('us') > -1) {
              gkey = 'ABQIAAAAGY8Xhrw1zw6Ia3dwUJVxKRTJS-7AF824HWF-LEGG_6gzL0ZkfBQT0p-XmiKaYXSs5dqLmwxUcOYFhg';
            } else if (host.indexOf('code') > -1) {
              gkey = 'ABQIAAAAGY8Xhrw1zw6Ia3dwUJVxKRSkektzbySCskG-uSBRhNVqfsiLxhS38a_4Pa1t5Hnd3YL7zxVoTmiw9A';
            }
            document.write('<script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=' + gkey + '"  type="text/javascript"><' + '/script>');
        </script>
        <script type="text/javascript" src="../src/arcgislink.js">
        </script>
        <script type="text/javascript">
            
            
            function round(num, dec){
              return Math.round(num * (10 ^ dec)) / (10 ^ dec);
            }
            
            function testSR(sr, lnglat, coords){
              var res = sr.forward(lnglat);
              var ex = coords;
              YAHOO.util.Assert.areEqual(0, round(res[0] - ex[0], 4), "\nexpected" + ex + "\nactual" + res);
              YAHOO.util.Assert.areEqual(0, round(res[1] - ex[1], 4), "\nexpected" + ex + "\nactual" + res);
              res = sr.reverse(coords);
              ex = lnglat;
              YAHOO.util.Assert.areEqual(0, round(res[0] - ex[0], 6), "\nexpected" + ex + "\nactual" + res);
              YAHOO.util.Assert.areEqual(0, round(res[1] - ex[1], 6), "\nexpected" + ex + "\nactual" + res);
            }
            
            var agsService;
            var caseSR = function(){
              return new YAHOO.tool.TestCase({
                name: "SR",
                testSphereMercator: function(){
                  testSR(new ArcGISSphereMercator({
                    wkid: 102113,
                    semi_major: 6378137.0,
                    central_meridian: 0,
                    unit: 1
                  }), [-117, 34], [-13024380.422813, 4028802.02613441]);
                },
                testLambertConformalConic: function(){
                  testSR(new ArcGISLambertConformalConic({
                    wkid: 2264,
                    semi_major: 6378137.0,
                    inverse_flattening: 298.257222101,
                    standard_parallel_1: 34.33333333333334,
                    standard_parallel_2: 36.16666666666666,
                    central_meridian: -79.0,
                    latitude_of_origin: 33.75,
                    'false_easting': 2000000.002616666,
                    'false_northing': 0,
                    unit: 0.3048006096012192
                  }), [-80.5666, 35.102363], [1531463.95, 495879.744]);
                },
                testTransverseMercator: function(){
                  testSR(new ArcGISTransverseMercator({
                    wkid: 102667,
                    semi_major: 6378137.0,
                    inverse_flattening: 298.257222101,
                    central_meridian: -84.16666666666667,
                    latitude_of_origin: 30.0,
                    scale_factor: 0.9999,
                    'false_easting': 2296583.333333333,
                    'false_northing': 0,
                    unit: 0.3048006096012192
                  }), [-84.454308, 33.74561], [2209149.07977075, 1362617.71496891]);
                },
                testFlat: function(){
                  testSR(new ArcGISFlatSpatialReference({
                    wkid: 99999,
                    coords: {
                      xmin: 1247829.25288776,
                      ymin: 431309.40424384,
                      xmax: 1663488.62979739,
                      ymax: 687023.842770192
                    },
                    latlng: {
                      xmin: -81.5091782649894,
                      ymin: 34.908977464786,
                      xmax: -80.1324977913554,
                      ymax: 35.6324326952359
                    }
                  }), [ -81.5091782649894, 34.908977464786], [1247829.25288776, 431309.40424384]);
                }
                
                
              });
            }();
            
            var caseGeometry = function(){
              return new YAHOO.tool.TestCase({
                name: "Geometry",
                setUp: function(){
                  this.data = new GeometryService('http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer');
                  
                },
                testProjectPoint: function(){
                  var input = {
                    "x": -117,
                    "y": 34
                  };
                  var ex = {
                    x: -13024380.422813,
                    y: 4028802.02613441
                  };
                  this.data.project({
                    inSR: 4326,
                    outSR: 102113,
                    geometryType: 'esriGeometryPoint',
                    geometries: [input]
                  }, function(json){
                    var res = json.geometries[0];
                    YAHOO.util.Assert.areEqual(0, round(res.x - ex.x, 4), "\nexpected" + ex + "\nactual" + res);
                    YAHOO.util.Assert.areEqual(0, round(res.y - ex.y, 4), "\nexpected" + ex + "\nactual" + res);
                  });
                }
              });
            }();
            
            var caseArcGISUtil = function(){
              return new YAHOO.tool.TestCase({
                name: 'caseArcGISUtil',
                testGeometryToJSONPoint: function(){
                  var input, res, ex;
                  input = {
                    x: -13024380.422813,
                    y: 4028802.02613441
                  };
                  ex = '{x: -13024380.422813,y:4028802.02613441}'.replace(/ |"/g, '');
                  res = ArcGISUtil.fromGeometryToJSON(input);
                  YAHOO.util.Assert.areEqual(ex, res, "\nexpected" + ex + "\nactual" + res);
                },
                testGeometryToJSONPolyline: function(){
                  var input, res, ex;
                  input = {
                    "paths": [[[-97.06138, 32.837], [-97.06133, 32.836], [-97.06124, 32.834], [-97.06127, 32.832]], [[-97.06326, 32.759], [-97.06298, 32.755]]],
                    "spatialReference": {
                      "wkid": 4326
                    }
                  };
                  ex = '{"paths" : [  [ [-97.06138,32.837], [-97.06133,32.836], [-97.06124,32.834], [-97.06127,32.832] ],  [ [-97.06326,32.759], [-97.06298,32.755] ]],"spatialReference" : {"wkid" : 4326}}'.replace(/ |"/g, '');
                  res = ArcGISUtil.fromGeometryToJSON(input, true);
                  YAHOO.util.Assert.areEqual(ex, res, "\nexpected" + ex + "\nactual" + res);
                },
                testGeometryToJSONPolygon: function(){
                  var input, res, ex;
                  input = {
                    "rings": [[[-97.06138, 32.837], [-97.06133, 32.836], [-97.06124, 32.834], [-97.06127, 32.832], [-97.06138, 32.837]], [[-97.06326, 32.759], [-97.06298, 32.755], [-97.06153, 32.749], [-97.06326, 32.759]]],
                    "spatialReference": {
                      "wkid": 4326
                    }
                  };
                  ex = '{"rings" : [  [ [-97.06138,32.837], [-97.06133,32.836], [-97.06124,32.834], [-97.06127,32.832], [-97.06138,32.837] ], [ [-97.06326,32.759], [-97.06298,32.755], [-97.06153,32.749], [-97.06326,32.759] ]],"spatialReference" : {"wkid" : 4326}}'.replace(/ |"/g, '');
                  res = ArcGISUtil.fromGeometryToJSON(input, true);
                  YAHOO.util.Assert.areEqual(ex, res, "\nexpected" + ex + "\nactual" + res);
                },
                testGeometryToJSONMultipoint: function(){
                  var input, res, ex;
                  input = {
                    "points": [[-97.06138, 32.837], [-97.06133, 32.836], [-97.06124, 32.834], [-97.06127, 32.832]],
                    "spatialReference": {
                      "wkid": 4326
                    }
                  };
                  ex = '{"points" : [ [-97.06138,32.837], [-97.06133,32.836], [-97.06124,32.834], [-97.06127,32.832] ],spatialReference" : {"wkid" : 4326}}'.replace(/ |"/g, '');
                  res = ArcGISUtil.fromGeometryToJSON(input, true);
                  YAHOO.util.Assert.areEqual(ex, res, "\nexpected" + ex + "\nactual" + res);
                },
                testGeometryToJSONEvenlope: function(){
                  var input, res, ex;
                  input = {
                    "xmin": -109.55,
                    "ymin": 25.76,
                    "xmax": -86.39,
                    "ymax": 49.94,
                    "spatialReference": {
                      "wkid": 4326
                    }
                  };
                  ex = '{"xmin" : -109.55, "ymin" : 25.76, "xmax" : -86.39, "ymax" : 49.94,"spatialReference" : {"wkid" : 4326}}'.replace(/ |"/g, '');
                  res = ArcGISUtil.fromGeometryToJSON(input, true);
                  YAHOO.util.Assert.areEqual(ex, res, "\nexpected" + ex + "\nactual" + res);
                }
              });
              
            }();
            
            var suite = new YAHOO.tool.TestSuite("ags suite");
            
             suite.add(caseSR);
            // suite.add(caseGeometry);
             suite.add(caseArcGISUtil);
            YAHOO.util.Event.onDOMReady(function(){
              var logger = new YAHOO.tool.TestLogger("testLogger");
              YAHOO.tool.TestRunner.add(suite);
              YAHOO.tool.TestRunner.run();
            });
        </script>
    </head>
    <body class=" yui-skin-sam">
        <div id="testLogger" style="width:90%">
        </div>
    </body>
</html>
