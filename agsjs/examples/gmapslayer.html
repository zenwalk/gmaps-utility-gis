<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=7" />
        <!--The viewport meta tag is used to improve the presentation and behavior of the samples
        on iOS devices-->
        <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no"/>
        <title>Google Maps In ArcGIS JavaScript API</title>
        <link rel="stylesheet" type="text/css" href="http://serverapi.arcgisonline.com/jsapi/arcgis/2.6/js/dojo/dijit/themes/claro/claro.css">
        <style type="text/css">
            html, body {
                height: 100%;
                width: 100%;
                margin: 0;
                padding: 0;
            }
            
            body {
                overflow: hidden;
                font-family: Helvetica, Arial, sans-serif;
                font-size:small;
            }
            
            #map {
                overflow: hidden;
                padding: 0;
            }
        </style>
        <script type="text/javascript">
            var djConfig = {
              parseOnLoad: true,
              baseUrl: './',
              modulePaths: {
                // if use local copy, make sure the path reference is relative to 'baseUrl', e.g.:
                //'agsjs': '../build/agsjs'
               // use absolute path for online version. Note sometimes googlecode.com can be slow.
                'agsjs': 'http://gmaps-utility-gis.googlecode.com/svn/tags/agsjs/1.07/build/agsjs'
              }
            };
        </script>
        <script type="text/javascript" src="http://serverapi.arcgisonline.com/jsapi/arcgis/?v=2.6">
        </script>
        
        <script type="text/javascript">
            dojo.require("dijit.dijit");
            dojo.require("dijit.form.Button");
            dojo.require("dijit.layout.BorderContainer");
            dojo.require("dijit.layout.ContentPane");
            dojo.require("esri.map");
            
            dojo.require("agsjs.layers.GoogleMapsLayer");
            var map, googleLayer, esriTopo, dyna;
            var visible = [];
            
            function init() {
              //US: "xmin": -13220472,  "ymin": 3459539, "xmax": -8817699, "ymax": 6394721,
              var initExtent = new esri.geometry.Extent({
                "xmin": -9031493,
                "ymin": 4170327,
                "xmax": -8962700,
                "ymax": 4216189,
                "spatialReference": {
                  "wkid": 102100
                }
              });
              
              
              map = new esri.Map("map", {
                extent: initExtent,
                logo: false
              });
              dojo.connect(map, 'onLoad', function(map) {
                dojo.connect(dijit.byId('map'), 'resize', resizeMap);
              });
              googleLayer = new agsjs.layers.GoogleMapsLayer({
                id: 'google',
                apiOptions: {
                  v: '3.6' // use a specific version is recommended for production system. 
                },
                mapOptions: {
                  streetViewControl: true // use false if do not want street view. Default is false.
                  
                }
              });
              map.addLayer(googleLayer);
              if (googleLayer.loaded) {
                buildLayerList();
              } else {
                dojo.connect(googleLayer, 'onLoad', buildLayerList);
              }
              
              
              dojo.connect(googleLayer, "onStreetViewVisibilityChange", function(v) {
                if (v) {
                  esri.hide(dojo.byId('buttons'));
                } else {
                  esri.show(dojo.byId('buttons'));
                }
              });
              esriTopo = new esri.layers.ArcGISTiledMapServiceLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer", {
                id: 'topo',
                visible: false
              });
              map.addLayer(esriTopo);
              operationalLayer = new esri.layers.ArcGISDynamicMapServiceLayer("http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Census_USA/MapServer", {
                "opacity": 0.5
              });
              map.addLayer(operationalLayer);
              
            }
            
            
            function changeMap(evt) {
              var name = dojo.trim(dijit.getEnclosingWidget(evt.target).label);
              if (name.indexOf('G-') != -1) {
                if (esriTopo) esriTopo.hide();
                googleLayer.show();
                esri.show(dojo.byId("layer_list"));
                switch (name) {
                case 'G-Street':
                  googleLayer.setMapTypeId(agsjs.layers.GoogleMapsLayer.MAP_TYPE_ROADMAP);
                  googleLayer.setMapStyles(null);
                  break;
                case 'G-Satellite':
                  googleLayer.setMapTypeId(agsjs.layers.GoogleMapsLayer.MAP_TYPE_SATELLITE);
                  break;
                case 'G-Hybrid':
                  googleLayer.setMapTypeId(agsjs.layers.GoogleMapsLayer.MAP_TYPE_HYBRID);
                  googleLayer.setMapStyles(null);
                  break;
                case 'G-Terrain':
                  googleLayer.setMapTypeId(agsjs.layers.GoogleMapsLayer.MAP_TYPE_TERRAIN);
                  googleLayer.setMapStyles(null);
                  break;
                case 'G-Gray':
                  googleLayer.setMapTypeId(agsjs.layers.GoogleMapsLayer.MAP_TYPE_ROADMAP);
                  googleLayer.setMapStyles(agsjs.layers.GoogleMapsLayer.MAP_STYLE_GRAY);
                  
                  break;
                case 'G-Night':
                  googleLayer.setMapTypeId(agsjs.layers.GoogleMapsLayer.MAP_TYPE_ROADMAP);
                  googleLayer.setMapStyles(agsjs.layers.GoogleMapsLayer.MAP_STYLE_NIGHT);
                  
                  break;
                case 'G-Random':
                  googleLayer.setMapTypeId(agsjs.layers.GoogleMapsLayer.MAP_TYPE_ROADMAP);
                  googleLayer.setMapStyles([{
                    stylers: [{
                      hue: '#' + Math.floor(Math.random() * parseInt('ffffff', 16)).toString(16)
                    }, {
                      lightness: Math.floor((Math.random() - 0.5) * 200)
                    }, {
                      saturation: Math.floor((Math.random() - 0.5) * 200)
                    }]
                  }]);
                  
                  break;
                }
                
              } else {
                esri.hide(dojo.byId("layer_list"));
                googleLayer.hide();
               if (esriTopo)  esriTopo.show();
              }
            }
            
            function buildLayerList() {
              var items = dojo.map(googleLayer.layerInfos, function(info, index) {
                //if (!info.subLayerIds) return;
                if (info.defaultVisibility) {
                  visible.push(info.id);
                }
                return "<br/><input type='checkbox' class='list_item' " + (info.defaultVisibility ? "checked='checked'" : "") + " id='" + info.id + "' onclick='updateLayerVisibility();' /><label for='" + info.id + "'>" + info.name + "</label>";
              });
              dojo.byId("layer_list").innerHTML = items.join('');
            }
            
            function updateLayerVisibility() {
              if (!googleLayer.visible) 
                return;
              
              
              var inputs = dojo.query(".list_item"), input;
              
              visible = [];
              
              dojo.forEach(inputs, function(input) {
                if (input.checked) {
                  visible.push(input.id);
                }
              });
              //if there aren't any layers visible set the array to be -1
              if (visible.length === 0) {
                visible.push(-1);
              }
              googleLayer.setVisibleLayers(visible);
            }
            
            var resizeTimer;
            function resizeMap() {
              //resize the map when the browser resizes - view the 'Resizing and repositioning the map' section in 
              //the following help topic for more details http://help.esri.com/EN/webapi/javascript/arcgis/help/jshelp_start.htm#jshelp/inside_faq.htm
              
              clearTimeout(resizeTimer);
              resizeTimer = setTimeout(function() {
                map.resize();
                map.reposition();
              }, 500);
            }
            
            //
            dojo.addOnLoad(init);
        </script>
    </head>
    <body class="claro">
        <div id="content" dojotype="dijit.layout.BorderContainer" design="headline" gutters="true" style="width: 100%; height: 100%;">
            <div id="header" dojotype="dijit.layout.ContentPane" region="top">
                <div>
                    <b>Use Google Maps as Base Map Layer in ESRI ArcGIS JSAPI</b>
                    <a style="right:20px;position:absolute" href="../docs/googlemapslayer/examples.html">Documentation</a>
                </div>
               
                <ul style="margin:2px">
                    <li>
                        Click buttons to switch base map between ESRI and Google. 
                    </li>
                    <li>
                        The "G-Random" button will show a different base map each time clicked. "Gray" and "Night" is fit for different scenarios.
                    </li>
                    <li>
                        Drag pegman icon on top left corner to map to see street view(hold mouse for preview). 
                    </li>
                    <li>
                        Check layer on/off to customize features to draw on base map. 
                        Note not all sub layer visible at all scales.
                    </li>
                     <li>
                        Can be used with BasemapGallery. See <a href="gmapsgallery.html">example</a>.
                    </li>
                </ul>
            </div>
            <div id="tocPane" dojotype="dijit.layout.ContentPane" region="left">
                <div>
                    Google Maps Sub Layers(features)
                </div>
                <div id="layer_list">
                </div>
            </div>
            <div id="map" dojotype="dijit.layout.ContentPane" region="center">
                <div id="buttons" style="position:absolute; right:75px; top:20px; z-Index:999;">
                    <button dojoType="dijit.form.Button" onClick="changeMap">
                        G-Street
                    </button>
                    <button dojoType="dijit.form.Button" onClick="changeMap">
                        G-Gray
                    </button>
                    <button dojoType="dijit.form.Button" onClick="changeMap">
                        G-Night
                    </button>
                    <button dojoType="dijit.form.Button" onClick="changeMap">
                        G-Random
                    </button>
                    <button dojoType="dijit.form.Button" onClick="changeMap">
                        G-Satellite
                    </button>
                    <button dojoType="dijit.form.Button" onClick="changeMap">
                        G-Hybrid
                    </button>
                    <button dojoType="dijit.form.Button" onClick="changeMap">
                        G-Terrain
                    </button>
                    <button dojoType="dijit.form.Button" onClick="changeMap">
                        ESRI-Topo
                    </button>
                </div>
            </div>
        </div>
    </body>
</html>